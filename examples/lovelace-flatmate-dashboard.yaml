# Resource `/hass_flatmate/static/hass-flatmate-shopping-card.js` is auto-added
# in Lovelace storage mode. Add it manually only if you use YAML resources mode.
title: Flatmate
views:
  - title: Flatmate
    path: flatmate
    type: sections
    max_columns: 3
    sections:
      - type: grid
        cards:
          - type: heading
            heading: Shopping
            icon: mdi:cart-outline

          - type: custom:hass-flatmate-shopping-card
            entity: sensor.hass_flatmate_shopping_data
            title: Shared Shopping

          - type: tile
            entity: sensor.hass_flatmate_shopping_open_count
            name: Shopping Open Items

          - type: picture-entity
            entity: image.hass_flatmate_shopping_distribution_90d
            name: Shopping Distribution (90 days)
            show_state: false
            show_name: true

      - type: grid
        cards:
          - type: heading
            heading: Cleaning
            icon: mdi:broom

          - type: entities
            title: Cleaning Rotation
            entities:
              - entity: sensor.hass_flatmate_cleaning_current_assignee
              - entity: sensor.hass_flatmate_cleaning_current_week_status
              - entity: sensor.hass_flatmate_cleaning_next_assignee
              - entity: button.hass_flatmate_mark_cleaning_done

          - type: entities
            title: Notification Test Mode
            entities:
              - entity: switch.hass_flatmate_notification_test_mode
              - entity: select.hass_flatmate_notification_test_target
              - entity: select.hass_flatmate_shopping_calendar_target
              - entity: select.hass_flatmate_cleaning_calendar_target

          - type: markdown
            title: Upcoming Cleaning Rotation
            content: >
              {% set weeks = state_attr('sensor.hass_flatmate_cleaning_schedule', 'weeks') or [] %}
              {% if weeks | length == 0 %}
              No schedule data yet.
              {% else %}
              | Week | Person | Dates | Note |
              | --- | --- | --- | --- |
              {% for row in weeks[:10] %}
              {% set start = as_datetime(row.week_start).strftime('%b %d') %}
              {% set finish = as_datetime(row.week_end).strftime('%b %d') %}
              {% set note = row.note if row.note else ('current: ' ~ row.status if row.is_current and row.status else '') %}
              | W{{ row.week_number }} | {{ row.assignee_name or ('Member ' ~ row.assignee_member_id) }} | {{ start }} - {{ finish }} | {{ note }} |
              {% endfor %}
              {% endif %}

      - type: grid
        cards:
          - type: heading
            heading: Activity
            icon: mdi:calendar-clock

          - type: entity
            entity: calendar.hass_flatmate_activity
            name: Flatmate Activity Calendar

          - type: markdown
            title: Recent Activity
            content: >
              {% set events = state_attr('sensor.hass_flatmate_activity_recent', 'recent_human') or [] %}
              {% if events | length == 0 %}
              No recent events.
              {% else %}
              {% for event in events[:10] %}
              - {{ relative_time(as_datetime(event.created_at)) }} | {{ event.summary }}
              {% endfor %}
              {% endif %}
